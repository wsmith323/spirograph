Plan-Id: 2026-02-25_215743Z-split-console-guidance-vs-analysis-concerns

# Split Console Guidance vs Analysis Concerns + Rename Post-Generation Header

## Summary

Treat this as one conceptual cleanup with two discrete changes:

1. **User-facing terminology fix (trivial, immediate value)**  
   Rename the post-generation header from `Curve guidance:` to
   `Curve analysis:`.

2. **Code-structure split (small, clean cut)**  
   Split the current mixed `spirograph/console_ui/guidance.py` module into:
   - `spirograph/console_ui/input_guidance.py` (manual-entry prompt helpers)
   - `spirograph/console_ui/curve_analysis.py` (post-generation analysis output
     and analysis helpers)

This preserves behavior and formulas. It only clarifies terminology and file
responsibilities.

## Goals and Success Criteria

- Align user-facing labels with actual behavior:
  - input-time text = guidance
  - post-generation text = analysis
- Remove the conceptual mismatch caused by a single `guidance.py` module holding
  both responsibilities.
- Keep all current console behavior and analysis math unchanged.
- Minimize churn (only update known imports/tests).

Success criteria:
- The console post-generation block starts with `Curve analysis:`
- `main.py` imports input helpers and analysis helpers from separate modules
- Tests pass with updated import paths and header assertion(s)

## In Scope

- `/Users/warren/work/projects/spirograph/spirograph/console_ui/guidance.py`
  (to be removed)
- `/Users/warren/work/projects/spirograph/spirograph/console_ui/input_guidance.py`
  (new)
- `/Users/warren/work/projects/spirograph/spirograph/console_ui/curve_analysis.py`
  (new)
- `/Users/warren/work/projects/spirograph/spirograph/main.py`
- `/Users/warren/work/projects/spirograph/tests/spirograph/console_ui/test_guidance.py`
  (rename/update)
- Any additional console UI tests affected by import path changes

## Out of Scope

- Changes to density/symmetry formulas or thresholds
- Generator/rendering behavior changes
- Console menu/command UX changes
- Broader console UI refactor beyond this split

## Public APIs / Interfaces / Types

No external/public API changes.

Internal module import changes:
- `describe_curve(...)` and analysis helpers move to `curve_analysis.py`
- `guide_before_*` helpers move to `input_guidance.py`

`main.py` import updates (exact intent):
- `describe_curve` imported from `spirograph.console_ui.curve_analysis`
- `guide_before_fixed_radius`, `guide_before_rolling_radius`,
  `guide_before_pen_offset` imported from `spirograph.console_ui.input_guidance`

## Discrete Changes (Decision Complete)

## Change A (User-facing wording): rename header to `Curve analysis:`

Update the post-generation analysis output in `describe_curve()`:
- Current: `Curve guidance:`
- New: `Curve analysis:`

Keep all other output lines unchanged in this pass (including the recently added
interpretation line and symmetry wording).

Why separate this explicitly:
- It is the immediate UX fix the user cares about.
- It is trivial and low risk.

## Change B (Implementation structure): split `guidance.py` into two modules

### New module: `spirograph/console_ui/input_guidance.py`
Move only manual-input helper functions here:
- `guide_before_fixed_radius(...)`
- `guide_before_rolling_radius(...)`
- `guide_before_pen_offset(...)`

Dependencies retained:
- `math`
- `CircularSpiroRequest`
- (No analysis-scoring helpers should live here)

### New module: `spirograph/console_ui/curve_analysis.py`
Move post-generation analysis logic here:
- `RepeatMetrics` dataclass
- `compute_curve_repeat_metrics(...)`
- `classify_closure_structure(...)`
- `classify_symmetry_feel(...)`
- `_offset_band_weight(...)`
- `compute_density_score(...)`
- `classify_density(...)`
- `describe_offset_tendency(...)`
- `_describe_curve_type(...)`
- `_describe_ratio_complexity(...)`
- `_build_density_notes(...)`
- `describe_curve(...)`

Update `describe_curve()` header line in this module as part of Change A.

### Remove old module
- Delete `spirograph/console_ui/guidance.py` after imports/tests are updated.
- No compatibility shim (`guidance.py` re-export) in this pass (clean cut).

## File/Test Naming Decisions

Rename test module for clarity:
- Current: `tests/spirograph/console_ui/test_guidance.py`
- New: `tests/spirograph/console_ui/test_curve_analysis.py`

Rationale:
- The tests cover analysis helpers/output, not manual input guidance.
- Keeps test names aligned with module responsibility.

No new tests required for `input_guidance.py` in this pass (wording-only prompt
helpers can remain untested if no existing tests cover them).

## Implementation Steps

1. Create `/Users/warren/work/projects/spirograph/spirograph/console_ui/curve_analysis.py`
   and move all post-generation analysis code from `guidance.py`
2. In `curve_analysis.py`, change `describe_curve()` header text from
   `Curve guidance:` to `Curve analysis:`
3. Create `/Users/warren/work/projects/spirograph/spirograph/console_ui/input_guidance.py`
   and move the three `guide_before_*` functions there
4. Update `/Users/warren/work/projects/spirograph/spirograph/main.py` imports to
   import analysis and input-guidance functions from the new modules
5. Rename
   `/Users/warren/work/projects/spirograph/tests/spirograph/console_ui/test_guidance.py`
   to
   `/Users/warren/work/projects/spirograph/tests/spirograph/console_ui/test_curve_analysis.py`
   and update imports from `spirograph.console_ui.guidance` to
   `spirograph.console_ui.curve_analysis`
6. Update output-smoke assertion(s) in the analysis test to expect
   `Curve analysis:` (and ensure `Curve guidance:` is absent if asserted)
7. Delete `/Users/warren/work/projects/spirograph/spirograph/console_ui/guidance.py`
8. Run targeted tests for the renamed analysis test module
9. Run full test suite
10. Stage all changes in git (`git add ...`)
11. Run the `capture-last-plan` skill to persist this plan

## Test Cases and Scenarios

## Automated tests (pytest)

### Update existing analysis tests (renamed file)
`tests/spirograph/console_ui/test_curve_analysis.py` should continue to cover:
- repeat metrics (hypo/epi, integer/GCD semantics)
- density buckets and thresholds
- closure/symmetry classifications
- offset tendency wording
- output-smoke assertions

### Add/adjust output-smoke assertions
Assert:
- `Curve analysis:` is present
- `Curve guidance:` is not present
- existing labels still present (e.g. `Closure repeats`,
  `Perceived symmetry while drawing`, `Visual density estimate`,
  `Interpretation:`)

## Manual Scenarios (Console UI)

- Generate a curve and verify the post-generation block now reads
  `Curve analysis:`
- Enter manual `m` flow and confirm pre-input helper text still behaves as
  guidance (no regressions in prompt flow)
- Run `a` (analyze current curve) and confirm wording remains coherent

## Validation Commands (Plan Defaults)

- Targeted:
  - `VIRTUAL_ENV=~/work/virtualenvs/spirograph ./scripts/test tests/spirograph/console_ui/test_curve_analysis.py -q`
- Full suite:
  - `VIRTUAL_ENV=~/work/virtualenvs/spirograph ./scripts/test -q`

## Risks / Regression Potential

- Low risk, but file moves can break imports if one path is missed.
- Renaming the test file can leave stale references in local tooling/scripts
  (none currently known from repo scan).
- Deleting `guidance.py` is safe because only `main.py` and the analysis test
  currently import it.

## Assumptions and Defaults Chosen

- Clean-cut split (no temporary shim) is acceptable.
- Header rename is part of the same unit of work and should ship together.
- Analysis formulas and classifications remain unchanged.
- The existing `Perceived symmetry while drawing` wording and interpretation
  line remain as-is in this pass (only header label changes).
